<!DOCTYPE html>
<html>
  <head>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.1/dist/aframe-extras.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/diarmidmackenzie/key-bindings@v0.3-alpha/key-bindings.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/diarmidmackenzie/6dof-object-control@v0.5-alpha/src/thumbstick-object-control.min.js"></script>
    <script src="./scale.js"></script>
  </head>
  <body>
    <a-scene renderer="colorManagement:true" stats
             cursor="rayOrigin: mouse; fuse: false"
             raycaster="objects: .clickable-object"
             background="color:black">
      <a-assets>
        <a-asset-item id="text" src="./assets/text/text.json">
        </a-asset-item>
        <!-- Assets ordered in order likely to be encountered.
             human scale objects first, then moving to extremes in
             each direction-->
        <a-asset-item id="trex-model"
           src="./assets/t-rex/scene.gltf"
           response-type="arraybuffer" crossorigin="anonymous">
        </a-asset-item>
      </a-assets>

      <!-- only supported movement is snap turns left / right (for desktop & seated VR)-->
      <a-entity id="rig" event-driven-movement
                         key-bindings="bindings:KeyQ=y-rot-plus,
                                                KeyE=y-rot-minus,
                                                #lhand.gripdown=y-rot-plus,
                                                #rhand.gripdown=y-rot-minus">

        <a-entity id="camera" camera position="0 1.6 0" look-controls>
        </a-entity>
        <a-entity id="scale" position="0 1.05 -0.85" rotation = "-45 0 0" scale-ruler="target:#scale-container">
        </a-entity>
        <a-entity id="info-panel" position="0 0.65 -0.45"
                  rotation = "-45 0 0" info-panel
                  clickable-object="id:#info-panel">
        </a-entity>
        <a-entity id="rhand"
                  laser-controls="hand: right" raycaster="objects: .clickable-object; lineColor: red; lineOpacity: 0.5"
                  laser-manipulation="defaultParent: #scale-container"
                  thumbstick-events__right="controller:#rhand;
                                            bindings:move-toward,move-away,y-rotate-entity-minus,y-rotate-entity-plus,"
                  hand-controls="hand: right">
        </a-entity>
        <a-entity id="lhand"
                  hand-controls="hand: left">
        </a-entity>
      </a-entity>
      <a-entity id="origin">
      </a-entity>
      <a-entity position="0 1 -4">
        <a-entity id="scale-container" scalable="center:#origin"
                  key-bindings="debug:true;
                                bindings:KeyN=$scaling-out,
                                         KeyM=$scaling-in"
                  thumbstick-states__left="controller:#lhand;
                                           bindings:scaling-in,scaling-out,none,none">
          <a-entity id="trex" position="-3 -1 0"
                    clickable-object="id:#trex"
                    gltf-model="#trex-model"
                    scale="0.06 0.06 0.06">
          </a-entity>          
      </a-entity>
    </a-scene>
  </body>
</html>
